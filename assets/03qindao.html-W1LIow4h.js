import{_ as o}from"./plugin-vue_export-helper-x3n3nnut.js";import{r as i,o as r,c as l,a as e,b as n,d as s,f as a}from"./app-0SoiKzJB.js";const c={},p=e("h1",{id:"调试解决通过webrtc连接unity画面到前端时产生的问题",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#调试解决通过webrtc连接unity画面到前端时产生的问题","aria-hidden":"true"},"#"),n(),e("strong",null,"调试解决通过webRTC连接unity画面到前端时产生的问题")],-1),d=e("h3",{id:"webrtc资料",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#webrtc资料","aria-hidden":"true"},"#"),n(" webRTC资料")],-1),u={href:"https://codelabs.developers.google.com/codelabs/webrtc-web#8",target:"_blank",rel:"noopener noreferrer"},h=e("p",null,"Unity Render Streaming:",-1),g={href:"https://docs.unity3d.com/Packages/com.unity.renderstreaming@3.1/manual/sample-browserinput.html",target:"_blank",rel:"noopener noreferrer"},m=a('<p><img src="https://cdn.jsdelivr.net/gh/lnitia/MyPictures@main/blogpictures/20240109170918.png" alt="" loading="lazy"></p><h2 id="局域网内连接问题" tabindex="-1"><a class="header-anchor" href="#局域网内连接问题" aria-hidden="true">#</a> 局域网内连接问题</h2><p><strong>一、从含unity画面的模块跳转到其他模块后返回时需刷新两次才能重连成功</strong></p><ul><li><ol><li>返回时报错：[impolite-Unity.RenderStreaming.PeerConnection] Failed to set remote offer sdp: The order of m-lines in subsequent offer doesn&#39;t match order from previous offer/answer.<img src="https://cdn.jsdelivr.net/gh/lnitia/MyPictures@main/blogpictures/20240109171228.png" alt="" loading="lazy"></li></ol></li><li><ol start="2"><li>第一次刷新后报错：[impolite-Unity.RenderStreaming.PeerConnection] Session error code: ERROR_CONTENT. Session error description: Failed to apply the description for m= section with mid=&#39;0&#39;: Failed to set SSL role for the transport..<img src="https://cdn.jsdelivr.net/gh/lnitia/MyPictures@main/blogpictures/20240109171417.png" alt="" loading="lazy"></li></ol></li><li><ol start="3"><li>其他报错：[impolite-Unity.RenderStreaming.PeerConnection] Failed to set remote answer sdp: Called in wrong state: stable<img src="https://cdn.jsdelivr.net/gh/lnitia/MyPictures@main/blogpictures/20240109171440.png" alt="" loading="lazy"></li></ol></li></ul><p><strong>思路</strong>：</p><p>1.检查offer sdp和answer sdp中m=xxx的顺序或数量是否一致</p>',6),b={href:"https://blog.csdn.net/csdn_shen0221/article/details/120367420",target:"_blank",rel:"noopener noreferrer"},_={href:"https://blog.mozilla.org/webrtc/perfect-negotiation-in-webrtc/",target:"_blank",rel:"noopener noreferrer"},f=e("p",null,"3.新建RTCPeerConnection给新增的连接对象",-1),k={href:"https://stackoverflow.com/questions/66062565/failed-to-set-remote-answer-sdp-called-in-wrong-state-stable",target:"_blank",rel:"noopener noreferrer"},y=a(`<p>signalingState = stable：</p><p>There is no ongoing exchange of offer and answer underway. This may mean that the RTCPeerConnection object is new, in which case both the localDescription and remoteDescription are ; it may also mean that negotiation is complete and a connection has been established.</p><p><strong>查找到的具体问题</strong>：</p><p>每次返回后会新建一个连接，但会在之前的连接中发送信息，导致与前面发送的m数量不匹配</p><p><strong>解决</strong>：</p><p>在退出该页面时关闭连接</p><div class="language-tsx line-numbers-mode" data-ext="tsx"><pre class="language-tsx"><code><span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">initializeRenderer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//进入页面时执行</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    videoPlayer<span class="token operator">?.</span><span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//退出页面时执行</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><p><strong>二、同一设备只有一个界面能交互，另外的界面暂停</strong></p><p><strong>问题</strong>：</p><p>新开的界面的信息会发送到原界面的连接中导致出现第一种报错</p><p><strong>解决方法</strong>：</p><ol><li>broadcast模式：将原界面的连接断开 → 识别新旧界面id → 将每个页面的connectionid设置为不同的（websocket为public模式）</li><li>single模式：websocket设置为private模式，即每开一个网页打开一个新的unity界面</li><li>unity render streaming中web browser input更换为receiver</li></ol>`,13),w={href:"https://github.com/Unity-Technologies/UnityRenderStreaming/tree/main/WebApp/client/public/receiver",target:"_blank",rel:"noopener noreferrer"},v=e("p",null,[e("strong",null,"三、前端点击事件传递不到unity")],-1),x=e("p",null,"打开unity的新版输入系统 input system package：",-1),R={href:"https://docs.unity3d.com/Packages/com.unity.inputsystem@1.5/manual/Settings.html",target:"_blank",rel:"noopener noreferrer"},C=a('<h2 id="平板连接问题" tabindex="-1"><a class="header-anchor" href="#平板连接问题" aria-hidden="true">#</a> 平板连接问题</h2><p><strong>一、连接问题</strong></p><ol><li>打开时会传输另外一个摄像机的画面</li><li>在关闭ipad后重新打开页面点不动，刷新后会回到另外一个画面</li></ol><ul><li>解决：删除single connection中的partCam stream sender（另外一个占位摄像机）</li></ul><p><strong>二、交互问题</strong></p><ol><li>下拉菜单点完马上就收起了</li></ol><ul><li>问题原因：触屏一次的状态变化为none-began-ended-ended-ended直到下一次触屏状态才会改变，但dropdown是在离开时打开或收起</li><li>思路：修改前端ended输入，只传第一个ended到unity</li><li>解决：关闭dropdown中的out on pointer exit设置，只有当鼠标选择下拉菜单中的选项或点击其他区域时才会收起</li></ul><ol start="2"><li>三向箭头上附加的图点不出来</li></ol><ul><li>思路：添加触屏对象</li><li>解决：在对应脚本中添加touchscreen内容</li><li>存在问题：点击不灵敏 → 点击一次会读取多次began或者读取不到began：将判定改为状态为ended且坐标值与上一帧不相等时执行</li></ul>',9);function P(S,T){const t=i("ExternalLinkIcon");return r(),l("div",null,[p,d,e("p",null,[n("webRTC codelab: "),e("a",u,[n("https://codelabs.developers.google.com/codelabs/webrtc-web#8"),s(t)])]),h,e("p",null,[e("a",g,[n("https://docs.unity3d.com/Packages/com.unity.renderstreaming@3.1/manual/sample-browserinput.html"),s(t)])]),m,e("p",null,[e("a",b,[n("https://blog.csdn.net/csdn_shen0221/article/details/120367420"),s(t)])]),e("p",null,[n("2."),e("a",_,[n("https://blog.mozilla.org/webrtc/perfect-negotiation-in-webrtc/"),s(t)])]),f,e("p",null,[e("a",k,[n("https://stackoverflow.com/questions/66062565/failed-to-set-remote-answer-sdp-called-in-wrong-state-stable"),s(t)])]),y,e("p",null,[e("a",w,[n("https://github.com/Unity-Technologies/UnityRenderStreaming/tree/main/WebApp/client/public/receiver"),s(t)])]),v,x,e("p",null,[e("a",R,[n("https://docs.unity3d.com/Packages/com.unity.inputsystem@1.5/manual/Settings.html"),s(t)])]),C])}const E=o(c,[["render",P],["__file","03qindao.html.vue"]]);export{E as default};
