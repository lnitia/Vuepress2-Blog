import{_ as t}from"./plugin-vue_export-helper-x3n3nnut.js";import{r as p,o as e,c as o,a as n,b as c,d as i,f as s}from"./app-0mkQjek1.js";const l="/assets/1716961414646-ZCtf84sw.png",u="/assets/1716961421855-dOzSvabP.png",r="/assets/1716961446938-iB6I82jC.png",d="/assets/1716961433747-jgAIBPgZ.png",k="/assets/1716961459659-jiMbw0mW.png",v="/assets/1716961469419-PcoxQjn-.png",m={},b=s('<h1 id="研究生小组周报系统开发" tabindex="-1"><a class="header-anchor" href="#研究生小组周报系统开发" aria-hidden="true">#</a> 研究生小组周报系统开发</h1><p>本系统开发用于研究生小组每周组会汇报使用</p><ul><li>周报前台：提交当周周报、展示个人所有周报、各周所有周报</li><li>周报后台：增加修改、删除周报功能、草稿箱功能、用户管理功能</li><li>后端：实现周报内容、用户信息、照片、文件增删改查功能</li></ul><p>作用：用于研究生小组汇报，可有效提高组会探讨效率</p><h2 id="一、周报前台" tabindex="-1"><a class="header-anchor" href="#一、周报前台" aria-hidden="true">#</a> 一、周报前台</h2><h3 id="_1-1-技术选型" tabindex="-1"><a class="header-anchor" href="#_1-1-技术选型" aria-hidden="true">#</a> 1.1 技术选型</h3><p>周报前台页面基于Vue2 + ElementUI + mavonEditor + axios开发</p><h3 id="_1-2-具体实现" tabindex="-1"><a class="header-anchor" href="#_1-2-具体实现" aria-hidden="true">#</a> 1.2 具体实现</h3><h4 id="_1-2-1-初始化" tabindex="-1"><a class="header-anchor" href="#_1-2-1-初始化" aria-hidden="true">#</a> 1.2.1 初始化</h4><h4 id="_1-2-2-路由跳转与权限" tabindex="-1"><a class="header-anchor" href="#_1-2-2-路由跳转与权限" aria-hidden="true">#</a> 1.2.2 路由跳转与权限</h4><h4 id="_1-2-3-注册与登录" tabindex="-1"><a class="header-anchor" href="#_1-2-3-注册与登录" aria-hidden="true">#</a> 1.2.3 注册与登录</h4><p><img src="'+l+'" alt="1716961414646" loading="lazy"></p><p><img src="'+u+'" alt="1716961421855" loading="lazy"></p><h4 id="_1-2-4-组件使用" tabindex="-1"><a class="header-anchor" href="#_1-2-4-组件使用" aria-hidden="true">#</a> 1.2.4 组件使用</h4><p><img src="'+r+'" alt="1716961446938" loading="lazy"></p><h4 id="_1-2-5-mavoneditor使用" tabindex="-1"><a class="header-anchor" href="#_1-2-5-mavoneditor使用" aria-hidden="true">#</a> 1.2.5 mavonEditor使用</h4><p><img src="'+d+'" alt="1716961433747" loading="lazy"></p><h2 id="二、周报后台" tabindex="-1"><a class="header-anchor" href="#二、周报后台" aria-hidden="true">#</a> 二、周报后台</h2><h3 id="_2-1-技术选型" tabindex="-1"><a class="header-anchor" href="#_2-1-技术选型" aria-hidden="true">#</a> 2.1 技术选型</h3><p>周报后台管理系统选用Vue-admin-template中后台框架，基于Vue2 + elementUI + mavonEditor + axios + vueX开发</p><h3 id="_2-2-具体实现" tabindex="-1"><a class="header-anchor" href="#_2-2-具体实现" aria-hidden="true">#</a> 2.2 具体实现</h3><p><img src="'+k+'" alt="1716961459659" loading="lazy"></p><p><img src="'+v+`" alt="1716961469419" loading="lazy"></p><h2 id="三、周报后端" tabindex="-1"><a class="header-anchor" href="#三、周报后端" aria-hidden="true">#</a> 三、周报后端</h2><h3 id="_3-1-技术选型" tabindex="-1"><a class="header-anchor" href="#_3-1-技术选型" aria-hidden="true">#</a> 3.1 技术选型</h3><p>周报后端基于node.js，采用express + mysql开发，使用joi设置验证规则，cors解决跨域，express-jwt解析token等</p><h3 id="_3-2-具体实现" tabindex="-1"><a class="header-anchor" href="#_3-2-具体实现" aria-hidden="true">#</a> 3.2 具体实现</h3><h4 id="_3-2-1-express框架" tabindex="-1"><a class="header-anchor" href="#_3-2-1-express框架" aria-hidden="true">#</a> 3.2.1 express框架</h4><p>Express是一个最小的，灵活的Node.js Web应用程序框架，它提供了一套强大的功能来开发Web和移动应用程序，有助于基于Node.js的Web应用程序的快速开发。</p><p>Express框架的核心功能是：</p><ol><li>允许设立中间件响应HTTP请求</li><li>定义了用于执行基于HTTP方法和URL不同动作的路由表</li><li>允许动态渲染基于参数传递给模板HTML页面</li></ol><p>实现流程：</p><ol><li>安装</li></ol><p><code>$ npm install -g express-generator</code></p><ol start="2"><li>创建express框架</li></ol><p><code> $ express xxx</code></p><ol start="3"><li>在app.js中创建express应用</li></ol><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>
<span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;express&#39;</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">,</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;server is running on port 3000&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-2-2-mysql" tabindex="-1"><a class="header-anchor" href="#_3-2-2-mysql" aria-hidden="true">#</a> 3.2.2 MySQL</h4>`,39),h={href:"https://blog.csdn.net/2301_76669854/article/details/138500828",target:"_blank",rel:"noopener noreferrer"},g=s(`<p>数据库连接：</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> mysql <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;mysql&#39;</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> db <span class="token operator">=</span> mysql<span class="token punctuation">.</span><span class="token function">createPool</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token comment">// host: &#39;127.0.0.1&#39;,</span>
    <span class="token literal-property property">host</span><span class="token operator">:</span><span class="token string">&#39;localhost&#39;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">user</span><span class="token operator">:</span><span class="token string">&#39;root&#39;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">password</span><span class="token operator">:</span><span class="token string">&#39;xxxx&#39;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">database</span><span class="token operator">:</span><span class="token string">&#39;my_db_01&#39;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

db<span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> connection</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&#39;Error connecting to MySQL database: &#39;</span><span class="token operator">+</span>err<span class="token punctuation">.</span>stack<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>  
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;Connected to MySQL database with connection id: &#39;</span><span class="token operator">+</span>connection<span class="token punctuation">.</span>threadId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    connection<span class="token punctuation">.</span><span class="token function">release</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> db
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>数据库操作：</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">//获取当前用户信息</span>
exports<span class="token punctuation">.</span><span class="token function-variable function">getUserInfo</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  db<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>
    <span class="token string">&quot;select id, username, nickname, email, user_pic from ev_users where id=?&quot;</span><span class="token punctuation">,</span>
    req<span class="token punctuation">.</span>user<span class="token punctuation">.</span>id<span class="token punctuation">,</span>
    <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> results</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> returnres<span class="token punctuation">.</span><span class="token function">cc</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// 2. 执行 SQL 语句成功，但是查询到的数据条数不等于 1</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>results<span class="token punctuation">.</span>length<span class="token operator">!==</span><span class="token number">1</span><span class="token punctuation">)</span> returnres<span class="token punctuation">.</span><span class="token function">cc</span><span class="token punctuation">(</span><span class="token string">&quot;获取用户信息失败！&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">status</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token literal-property property">message</span><span class="token operator">:</span><span class="token string">&quot;获取用户基本信息成功！&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">data</span><span class="token operator">:</span>results<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-2-3-joi数据校验" tabindex="-1"><a class="header-anchor" href="#_3-2-3-joi数据校验" aria-hidden="true">#</a> 3.2.3 joi数据校验</h4><p>joi是一个强大的数据校验模块，可以对数据进行格式和数据类型上的校验，支持正则表达式</p><p>常用验证规则：</p><ol><li>string() 值必须是字符串</li><li>alphanum() 值只能是包含 a-zA-Z0-9 的字符串</li><li>min(length) 最小长度</li><li>max(length) 最大长度</li><li>required() 值是必填项，不能为 undefined</li><li>pattern(正则表达式) 值必须符合正则表达式的规则</li></ol><p>登录验证示例：</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> joi <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;joi&#39;</span><span class="token punctuation">)</span>

<span class="token comment">// 用户名的验证规则</span>
<span class="token keyword">const</span> username <span class="token operator">=</span> joi<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">required</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">// 密码的验证规则</span>
<span class="token keyword">const</span> password <span class="token operator">=</span> joi<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pattern</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^[\\S]{6,12}$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">required</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  
<span class="token comment">// dataUri() 指的是如下格式的字符串数据：</span>
<span class="token comment">// data:image/png;base64,VE9PTUFOWVNFQ1JFVFM=</span>
<span class="token keyword">const</span> avatar <span class="token operator">=</span> joi<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">dataUri</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">required</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// 注册和登录表单的验证规则对象</span>
exports<span class="token punctuation">.</span>reg_login_schema <span class="token operator">=</span> <span class="token punctuation">{</span>  
  <span class="token comment">// 表示需要对 req.body 中的数据进行验证</span>
  <span class="token literal-property property">body</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    username<span class="token punctuation">,</span>
    password<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
<span class="token comment">// 验证规则对象 - 重置密码</span>
exports<span class="token punctuation">.</span>update_password_schema <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">body</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// 使用 password 这个规则，验证 req.body.oldPwd 的值</span>
    <span class="token literal-property property">oldPwd</span><span class="token operator">:</span>password<span class="token punctuation">,</span>
    <span class="token comment">// 使用 joi.not(joi.ref(&#39;oldPwd&#39;)).concat(password) 规则，验证 req.body.newPwd 的值</span>
    <span class="token comment">// 解读：</span>
    <span class="token comment">// 1. joi.ref(&#39;oldPwd&#39;) 表示 newPwd 的值必须和 oldPwd 的值保持一致</span>
    <span class="token comment">// 2. joi.not(joi.ref(&#39;oldPwd&#39;)) 表示 newPwd 的值不能等于 oldPwd 的值</span>
    <span class="token comment">// 3. .concat() 用于合并 joi.not(joi.ref(&#39;oldPwd&#39;)) 和 password 这两条验证规则</span>
    <span class="token literal-property property">newPwd</span><span class="token operator">:</span>joi<span class="token punctuation">.</span><span class="token function">not</span><span class="token punctuation">(</span>joi<span class="token punctuation">.</span><span class="token function">ref</span><span class="token punctuation">(</span><span class="token string">&#39;oldPwd&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>password<span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
<span class="token comment">// 验证规则对象 - 更新头像</span>
exports<span class="token punctuation">.</span>update_avatar_schema <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">body</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    avatar<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-2-4-cors跨域" tabindex="-1"><a class="header-anchor" href="#_3-2-4-cors跨域" aria-hidden="true">#</a> 3.2.4 cors跨域</h4><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">&#39;Access-Control-Allow-Origin&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;*&#39;</span><span class="token punctuation">)</span>  <span class="token comment">//允许所有来源的请求</span>
    res<span class="token punctuation">.</span><span class="token function">header</span><span class="token punctuation">(</span><span class="token string">&#39;Access-Control-Allow-Headers&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;Authorization,X-API-KEY, Origin, X-Requested-With, Content-Type, Accept, Access-Control-Request-Method&#39;</span><span class="token punctuation">)</span>
    res<span class="token punctuation">.</span><span class="token function">header</span><span class="token punctuation">(</span><span class="token string">&#39;Access-Control-Allow-Methods&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;GET, POST, OPTIONS, PATCH, PUT, DELETE&#39;</span><span class="token punctuation">)</span>
    res<span class="token punctuation">.</span><span class="token function">header</span><span class="token punctuation">(</span><span class="token string">&#39;Allow&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;GET, POST, PATCH, OPTIONS, PUT, DELETE&#39;</span><span class="token punctuation">)</span>
    res<span class="token punctuation">.</span><span class="token function">header</span><span class="token punctuation">(</span><span class="token string">&quot;Access-Control-Allow-Credentials&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;true&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-2-5-身份验证" tabindex="-1"><a class="header-anchor" href="#_3-2-5-身份验证" aria-hidden="true">#</a> 3.2.5 身份验证</h4><p>express-jwt 是 Node.js 的一个开源库，是专用于 express 框架下解析 JWT 的中间件。</p><p>JWT 全称 JSON Web Token，是代替传统 session 认证的解决方案。其原理是服务端生成一个包含用户唯一标识的 JSON 对象，颁发给客户端。客户端请求需要权限的接口时，只要把这个 JSON 再原样发回给服务端，服务器通过解析就可识别用户。</p><p>这个 JSON 对象通过 <code>.</code> 分成三段，包含了请求头Header（加密算法）、负载信息Payload（如 userId、过期时间），还有通过服务端密钥生成的签名Signature来保证不被篡改。这种机制使服务端不再需要存储 Token，因此是非常轻量的用户认证方案。</p><ol><li>JWT设置token</li></ol><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> jwt <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;jsonwebtoken&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> tokenStr <span class="token operator">=</span> jwt<span class="token punctuation">.</span><span class="token function">sign</span><span class="token punctuation">(</span>user<span class="token punctuation">,</span> config<span class="token punctuation">.</span>jwtSecretKey<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">expiresIn</span><span class="token operator">:</span><span class="token string">&quot;10h&quot;</span><span class="token punctuation">,</span> <span class="token comment">// token 有效期为 10 个小时</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">status</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">&quot;登录成功！&quot;</span><span class="token punctuation">,</span>
  <span class="token comment">// 为了方便客户端使用 Token，在服务器端直接拼接上 Bearer 的前缀</span>
  <span class="token comment">// Bearer 是一种身份验证方案类型（Authentication Scheme），Bearer 作为一个字符串附加到 Token 前面，构成了一种规范的表示方式，即 Bearer Token</span>
  <span class="token literal-property property">token</span><span class="token operator">:</span> <span class="token string">&quot;Bearer &quot;</span> <span class="token operator">+</span> tokenStr<span class="token punctuation">,</span>
  user
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li>express-jwt解析token</li></ol><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> expressJWT <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;express-jwt&#39;</span><span class="token punctuation">)</span>
<span class="token comment">// 使用 .unless({ path: [/^\\/api\\//] }) 指定哪些接口不需要进行 Token 的身份认证</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">expressJWT</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">secret</span><span class="token operator">:</span>config<span class="token punctuation">.</span>jwtSecretKey <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unless</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^\\/api\\/</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="3"><li>验证错误</li></ol><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// 配置验证错误中间件</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 数据验证失败</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>errinstanceofjoi<span class="token punctuation">.</span>ValidationError<span class="token punctuation">)</span> returnres<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">.</span>name<span class="token operator">===</span><span class="token string">&#39;UnauthorizedError&#39;</span><span class="token punctuation">)</span> returnres<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&#39;身份认证失败！&#39;</span><span class="token punctuation">)</span>
    <span class="token comment">// 未知错误</span>
    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,22);function f(x,y){const a=p("ExternalLinkIcon");return e(),o("div",null,[b,n("p",null,[n("a",h,[c("node.js对数据库mysql的连接与操作（增、删、改、查、五种SQL语法）"),i(a)])]),g])}const j=t(m,[["render",f],["__file","02wb.html.vue"]]);export{j as default};
